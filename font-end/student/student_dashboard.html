<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="H·ªá th·ªëng Qu·∫£n l√Ω ƒë·ªì √°n m√¥n h·ªçc c·ªßa Sinh vi√™n HUTECH.">
    <meta name="copyright" content="¬© 2025 - Nh√≥m TAD Programmer Khoa C√¥ng ngh·ªá Th√¥ng tin - Tr∆∞·ªùng ƒê·∫°i h·ªçc C√¥ng ngh·ªá TP.HCM - HUTECH. T·∫•t c·∫£ quy·ªÅn ƒë∆∞·ª£c b·∫£o l∆∞u.">
    <title>HUTECH | H·ªá th·ªëng Sinh vi√™n</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="/font-end/static/css/styles_student.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="icon" href="/font-end/static/img/img_logohutech.png" type="image/png">
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <h4 class="text-center mb-4">üéì H·ªá th·ªëng Sinh vi√™n</h4>
        <a href="/font-end/student/student_dashboard.html" class="active"><i class="bi bi-house-door"></i> Trang ch·ªß</a>
        <a href="/font-end/student/student_submissions_list.html"><i class="bi bi-upload"></i> N·ªôp b√†i t·∫≠p ƒë·ªì √°n <span class="badge bg-danger ms-2" id="pendingTasks">0</span></a>
        <a href="/font-end/student/student_tracking_list.html"><i class="bi bi-bar-chart-line"></i> Theo d√µi ti·∫øn ƒë·ªô ƒë·ªì √°n</a>
        <a href="/font-end/student/student_history_submissions_list.html"><i class="bi bi-clock-history"></i> Xem l·ªãch s·ª≠ n·ªôp b√†i</a>
        <a href="/font-end/student/student_proposals_list.html"><i class="bi bi-lightbulb"></i> ƒê·ªÅ xu·∫•t ƒë·ªÅ t√†i ƒë·ªì √°n</a>
        <a href="/font-end/student/student_schedule.html"><i class="bi bi-calendar"></i> L·ªãch c√° nh√¢n</a>
        <a href="/font-end/student/student_grades_list.html"><i class="bi bi-award"></i> H·ªá th·ªëng ch·∫•m ƒëi·ªÉm</a>
    </div>

    <!-- Main Content -->
    <div class="content" id="content">
        <!-- Navbar -->
        <nav class="navbar navbar-expand-lg px-3">
            <button id="toggleSidebarBtn" class="btn btn-outline-light me-2">
                <i id="sidebarIcon" class="bi bi-list"></i>
            </button>
            <div class="ms-auto d-flex align-items-center">
                <input type="text" class="search-box me-3" placeholder="üîç T√¨m ki·∫øm..." id="searchInput" onkeyup="filterTable()">
                <button id="calendarBtn" class="btn"><i class="bi bi-calendar"></i></button>
                <button id="toggleFullscreen" class="btn"><i class="bi bi-arrows-fullscreen"></i></button>
                <button id="toggleTheme" class="btn"><i class="bi bi-moon"></i></button>
                <button id="notificationBtn" class="btn position-relative">
                    <i class="bi bi-bell"></i>
                    <span class="badge bg-danger position-absolute top-0 start-100 translate-middle" id="unreadCount">0</span>
                </button>
                <button id="profileBtn" class="btn"><i class="bi bi-person-circle"></i></button>
            </div>
        </nav>

        <!-- Profile Dropdown -->
        <div class="profile-dropdown" id="profileDropdown">
            <div class="profile-header">
                <img src="/font-end/static/medit/imgUser/avatar.jpg" alt="User Avatar">
                <h6 id="userName">Nguy·ªÖn Tri B√£o Th·∫Øng</h6>
                <p id="userEmail">nguyentribaothang@gmail.com</p>
            </div>
            <div class="profile-menu">
                <a href="#"><i class="bi bi-gear"></i> C√†i ƒë·∫∑t hi·ªÉn th·ªã</a>
                <a href="#" id="toggleFullscreenBtn"><i class="bi bi-arrows-fullscreen"></i> To√†n m√†n h√¨nh</a>
                <a href="#"><i class="bi bi-arrow-clockwise"></i> Kh√¥i ph·ª•c m·∫∑c ƒë·ªãnh</a>
                <a href="/font-end/login/login.html" class="logout" onclick="logout()"><i class="bi bi-box-arrow-right"></i> ƒêƒÉng xu·∫•t</a>
            </div>
        </div>

        <!-- Dashboard Section -->
        <div class="container mt-4">
            <h2 class="fw-bold text-primary">üìä B·∫¢NG ƒêI·ªÄU KHI·ªÇN</h2>

            <!-- Breadcrumb -->
            <nav class="breadcrumb-container">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item">
                        <a href="/font-end/student/student_dashboard.html"><i class="bi bi-house-door"></i></a>
                    </li>
                    <li class="breadcrumb-item active">
                        <i class="bi bi-house-door-fill"></i> T·ªïng quan
                    </li>
                </ol>
            </nav>

            <!-- Th·ªëng k√™ -->
            <div class="row mt-4">
                <!-- B√†i t·∫≠p ƒë√£ n·ªôp -->
                <div class="col-md-4">
                    <div class="card-dashboard shadow">
                        <div class="card-header d-flex align-items-center">
                            <i class="bi bi-upload text-primary fs-4 me-2"></i> <h5 class="mb-0">B√†i t·∫≠p ƒë√£ n·ªôp</h5>
                        </div>
                        <div class="card-content text-center">
                            <canvas id="submissionChart"></canvas>
                            <p class="fw-bold mt-2 text-success">T·ªïng s·ªë: <span id="totalSubmissions">0</span></p>
                        </div>
                        <div class="card-footer text-center text-muted">üìÖ C·∫≠p nh·∫≠t: H√¥m nay</div>
                    </div>
                </div>
                <!-- Ti·∫øn ƒë·ªô ƒë·ªì √°n -->
                <div class="col-md-4">
                    <div class="card-dashboard shadow">
                        <div class="card-header d-flex align-items-center">
                            <i class="bi bi-bar-chart-line text-success fs-4 me-2"></i> <h5 class="mb-0">Ti·∫øn ƒë·ªô ƒë·ªì √°n</h5>
                        </div>
                        <div class="card-content">
                            <canvas id="progressChart"></canvas>
                        </div>
                        <div class="card-footer text-center text-muted">üìÖ C·∫≠p nh·∫≠t: H√¥m nay</div>
                    </div>
                </div>
                <!-- ƒê·ªÅ xu·∫•t ƒë·ªÅ t√†i -->
                <div class="col-md-4">
                    <div class="card-dashboard shadow">
                        <div class="card-header d-flex align-items-center">
                            <i class="bi bi-lightbulb text-warning fs-4 me-2"></i> <h5 class="mb-0">ƒê·ªÅ xu·∫•t ƒë·ªÅ t√†i</h5>
                        </div>
                        <div class="card-content text-center">
                            <p>Ch∆∞a c√≥ ƒë·ªÅ t√†i n√†o ƒë∆∞·ª£c ƒë·ªÅ xu·∫•t.</p>
                            <a href="/font-end/student/student_proposals_list.html" class="btn btn-primary">ƒê·ªÅ xu·∫•t ngay</a>
                        </div>
                        <div class="card-footer text-center text-muted">üìÖ C·∫≠p nh·∫≠t: H√¥m nay</div>
                    </div>
                </div>
            </div>

            <!-- Th√¥ng b√°o v√† L·ªãch c√° nh√¢n -->
            <div class="row mt-4">
                <!-- Th√¥ng b√°o m·ªõi -->
                <div class="col-md-6">
                    <div class="card-dashboard shadow">
                        <div class="card-header d-flex align-items-center justify-content-between">
                            <div class="d-flex align-items-center">
                                <i class="bi bi-bell text-danger fs-4 me-2"></i> <h5 class="mb-0">Th√¥ng b√°o m·ªõi</h5>
                            </div>
                            <span class="badge bg-danger" id="unreadNotifications">0</span>
                        </div>
                        <div class="card-content">
                            <ul class="list-group list-group-flush" id="notificationList"></ul>
                            <div class="text-center mt-2" id="viewMoreNotifications" style="display: none;">
                                <a href="/font-end/student/notifications_list.html" class="btn btn-sm btn-primary">Xem th√™m</a>
                            </div>
                        </div>
                        <div class="card-footer text-center text-muted">üìÖ C·∫≠p nh·∫≠t: H√¥m nay</div>
                    </div>
                </div>
                <!-- L·ªãch c√° nh√¢n -->
                <div class="col-md-6">
                    <div class="card-dashboard shadow">
                        <div class="card-header d-flex align-items-center">
                            <i class="bi bi-calendar text-primary fs-4 me-2"></i> <h5 class="mb-0">L·ªãch c√° nh√¢n</h5>
                        </div>
                        <div class="card-content">
                            <ul class="list-group list-group-flush" id="calendarList"></ul>
                        </div>
                        <div class="card-footer text-center text-muted">üìÖ C·∫≠p nh·∫≠t: H√¥m nay</div>
                    </div>
                </div>
            </div>

            <!-- C√¥ng vi·ªác s·∫Øp ƒë·∫øn h·∫°n -->
            <h2 class="fw-bold text-primary mt-5">üìå C√¥ng vi·ªác s·∫Øp ƒë·∫øn h·∫°n</h2>
            <div class="table-container">
                <div class="table-header">
                    <input type="text" id="taskSearchInput" class="form-control" placeholder="üîç T√¨m c√¥ng vi·ªác..." onkeyup="filterTable()">
                    <select id="statusFilter" class="form-select" onchange="filterTable()">
                        <option value="">üìÇ Tr·∫°ng th√°i</option>
                        <option value="Ch∆∞a n·ªôp">Ch∆∞a n·ªôp</option>
                        <option value="ƒê√£ n·ªôp">ƒê√£ n·ªôp</option>
                    </select>
                </div>
                <div class="table-content">
                    <table class="table-custom table-bordered table-hover">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>B√†i t·∫≠p</th>
                                <th>M√¥n h·ªçc</th>
                                <th>H·∫°n ch√≥t</th>
                                <th>Th·ªùi gian c√≤n l·∫°i</th>
                                <th>Tr·∫°ng th√°i</th>
                                <th>H√†nh ƒë·ªông</th>
                            </tr>
                        </thead>
                        <tbody id="taskTable"></tbody>
                    </table>
                </div>
                <div class="table-footer">
                    <ul id="pagination" class="pagination"></ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <div class="footer">
        B·∫£n quy·ªÅn c·ªßa HUTECH ‚Äì Ph√°t tri·ªÉn b·ªüi Team TAD Programmer ¬©2025
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // C·∫•u h√¨nh API
        const API_URL = "https://localhost:7047";
        const token = localStorage.getItem("token");
        let dashboardData = {};
        let notifications = [];
        let tasks = [];
        let calendarEvents = [];
        let currentPage = 1;
        const itemsPerPage = 5;

        // Navbar Functions
        document.getElementById("toggleSidebarBtn").addEventListener("click", toggleSidebar);
        document.getElementById("notificationBtn").addEventListener("click", () => window.location.href = "/font-end/student/notifications_list.html");
        document.getElementById("calendarBtn").addEventListener("click", () => window.location.href = "/font-end/student/student_schedule.html");
        document.getElementById("profileBtn").addEventListener("click", (event) => {
            event.stopPropagation();
            const dropdown = document.getElementById("profileDropdown");
            dropdown.style.display = dropdown.style.display === "block" ? "none" : "block";
        });
        document.addEventListener("click", (event) => {
            const dropdown = document.getElementById("profileDropdown");
            if (!dropdown.contains(event.target) && event.target.id !== "profileBtn") dropdown.style.display = "none";
        });
        document.getElementById("toggleFullscreen").addEventListener("click", () => {
            if (!document.fullscreenElement) document.documentElement.requestFullscreen();
            else document.exitFullscreen();
        });
        document.getElementById("toggleFullscreenBtn").addEventListener("click", () => {
            if (!document.fullscreenElement) document.documentElement.requestFullscreen();
            else document.exitFullscreen();
        });
        document.getElementById("toggleTheme").addEventListener("click", () => {
            document.body.classList.toggle("dark-mode");
            localStorage.setItem("theme", document.body.classList.contains("dark-mode") ? "dark" : "light");
        });
        if (localStorage.getItem("theme") === "dark") document.body.classList.add("dark-mode");

        // Toggle Sidebar
        function toggleSidebar() {
            const sidebar = document.getElementById("sidebar");
            const content = document.getElementById("content");
            const icon = document.getElementById("sidebarIcon");
            sidebar.classList.toggle("collapsed");
            content.classList.toggle("expanded");
            icon.classList.toggle("bi-list");
            icon.classList.toggle("bi-layout-sidebar-inset");
        }

        // T·∫£i th√¥ng tin ng∆∞·ªùi d√πng
        async function loadUserProfile() {
            try {
                const user = JSON.parse(localStorage.getItem("user"));
                if (!user || user.roleName !== "ROLE_STUDENT") {
                    throw new Error("Kh√¥ng c√≥ quy·ªÅn Sinh vi√™n ho·∫∑c ch∆∞a ƒëƒÉng nh·∫≠p.");
                }
                document.getElementById("userName").textContent = user.fullName || "Nguy·ªÖn Tri B√£o Th·∫Øng";
                document.getElementById("userEmail").textContent = user.email || "nguyentribaothang@gmail.com";
            } catch (error) {
                console.error("L·ªói khi t·∫£i th√¥ng tin ng∆∞·ªùi d√πng:", error);
                alert("Kh√¥ng c√≥ quy·ªÅn Sinh vi√™n ho·∫∑c ch∆∞a ƒëƒÉng nh·∫≠p.");
                logout();
            }
        }

        // T·∫£i d·ªØ li·ªáu dashboard
        async function loadDashboardData() {
            if (!token) {
                console.error("Kh√¥ng t√¨m th·∫•y token. Vui l√≤ng ƒëƒÉng nh·∫≠p l·∫°i.");
                alert("Vui l√≤ng ƒëƒÉng nh·∫≠p l·∫°i.");
                logout();
                return;
            }
            try {
                const response = await fetch(`${API_URL}/api/StudentDashboard`, {
                    method: "GET",
                    headers: {
                        "Accept": "*/*",
                        "Content-Type": "application/json",
                        "Authorization": `Bearer ${token}`
                    },
                    credentials: "include"
                });
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.message || `L·ªói ${response.status}: Kh√¥ng th·ªÉ t·∫£i d·ªØ li·ªáu dashboard`);
                }
                dashboardData = await response.json();
                document.getElementById("totalSubmissions").textContent = dashboardData.totalSubmissions;
                document.getElementById("pendingTasks").textContent = dashboardData.pendingTasks;
                document.getElementById("unreadNotifications").textContent = dashboardData.unreadNotifications;
                document.getElementById("unreadCount").textContent = dashboardData.unreadNotifications;
                renderCharts();
            } catch (error) {
                console.error("L·ªói khi t·∫£i d·ªØ li·ªáu dashboard:", error);
                alert(`Kh√¥ng t·∫£i ƒë∆∞·ª£c d·ªØ li·ªáu: ${error.message}`);
            }
        }

        // T·∫£i th√¥ng b√°o
        async function loadNotifications() {
            if (!token) {
                console.error("Kh√¥ng t√¨m th·∫•y token. Vui l√≤ng ƒëƒÉng nh·∫≠p l·∫°i.");
                alert("Vui l√≤ng ƒëƒÉng nh·∫≠p l·∫°i.");
                logout();
                return;
            }
            try {
                const response = await fetch(`${API_URL}/api/StudentDashboard/notifications?limit=5`, {
                    method: "GET",
                    headers: {
                        "Accept": "*/*",
                        "Content-Type": "application/json",
                        "Authorization": `Bearer ${token}`
                    },
                    credentials: "include"
                });
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.message || `L·ªói ${response.status}: Kh√¥ng th·ªÉ t·∫£i th√¥ng b√°o`);
                }
                notifications = await response.json();
                displayNotifications();
            } catch (error) {
                console.error("L·ªói khi t·∫£i th√¥ng b√°o:", error);
                alert(`Kh√¥ng t·∫£i ƒë∆∞·ª£c th√¥ng b√°o: ${error.message}`);
            }
        }

        // T·∫£i c√¥ng vi·ªác
        async function loadTasks() {
            if (!token) {
                console.error("Kh√¥ng t√¨m th·∫•y token. Vui l√≤ng ƒëƒÉng nh·∫≠p l·∫°i.");
                alert("Vui l√≤ng ƒëƒÉng nh·∫≠p l·∫°i.");
                logout();
                return;
            }
            try {
                const searchText = document.getElementById("taskSearchInput").value;
                const status = document.getElementById("statusFilter").value;
                const response = await fetch(`${API_URL}/api/StudentDashboard/tasks?searchText=${encodeURIComponent(searchText)}&status=${status}&page=${currentPage}&pageSize=${itemsPerPage}`, {
                    method: "GET",
                    headers: {
                        "Accept": "*/*",
                        "Content-Type": "application/json",
                        "Authorization": `Bearer ${token}`
                    },
                    credentials: "include"
                });
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.message || `L·ªói ${response.status}: Kh√¥ng th·ªÉ t·∫£i c√¥ng vi·ªác`);
                }
                const data = await response.json();
                tasks = data.tasks;
                displayTable(data.totalCount);
            } catch (error) {
                console.error("L·ªói khi t·∫£i c√¥ng vi·ªác:", error);
                document.getElementById("taskTable").innerHTML = '<tr><td colspan="7" class="text-center">Kh√¥ng t√¨m th·∫•y c√¥ng vi·ªác n√†o.</td></tr>';
                alert(`Kh√¥ng t·∫£i ƒë∆∞·ª£c c√¥ng vi·ªác: ${error.message}`);
            }
        }

        // T·∫£i s·ª± ki·ªán l·ªãch
        async function loadCalendarEvents() {
            if (!token) {
                console.error("Kh√¥ng t√¨m th·∫•y token. Vui l√≤ng ƒëƒÉng nh·∫≠p l·∫°i.");
                alert("Vui l√≤ng ƒëƒÉng nh·∫≠p l·∫°i.");
                logout();
                return;
            }
            try {
                const response = await fetch(`${API_URL}/api/StudentDashboard/calendar`, {
                    method: "GET",
                    headers: {
                        "Accept": "*/*",
                        "Content-Type": "application/json",
                        "Authorization": `Bearer ${token}`
                    },
                    credentials: "include"
                });
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.message || `L·ªói ${response.status}: Kh√¥ng th·ªÉ t·∫£i s·ª± ki·ªán l·ªãch`);
                }
                calendarEvents = await response.json();
                displayCalendarEvents();
            } catch (error) {
                console.error("L·ªói khi t·∫£i s·ª± ki·ªán l·ªãch:", error);
                alert(`Kh√¥ng t·∫£i ƒë∆∞·ª£c s·ª± ki·ªán l·ªãch: ${error.message}`);
            }
        }

        // V·∫Ω bi·ªÉu ƒë·ªì
        function renderCharts() {
            const ctx1 = document.getElementById("submissionChart").getContext("2d");
            new Chart(ctx1, {
                type: "doughnut",
                data: {
                    labels: Object.keys(dashboardData.submissionByProject || {}),
                    datasets: [{
                        data: Object.values(dashboardData.submissionByProject || {}),
                        backgroundColor: ["#4CAF50", "#2196F3", "#FF9800"]
                    }]
                },
                options: {
                    responsive: true,
                    plugins: { legend: { position: "bottom" }, tooltip: { enabled: true } }
                }
            });

            const ctx2 = document.getElementById("progressChart").getContext("2d");
            new Chart(ctx2, {
                type: "bar",
                data: {
                    labels: Object.keys(dashboardData.progressByProject || {}),
                    datasets: [{
                        label: "Ti·∫øn ƒë·ªô (%)",
                        data: Object.values(dashboardData.progressByProject || {}),
                        backgroundColor: ["#4CAF50", "#2196F3", "#FF9800"]
                    }]
                },
                options: {
                    responsive: true,
                    indexAxis: "y",
                    scales: { x: { beginAtZero: true, max: 100 } }
                }
            });
        }

        // Hi·ªÉn th·ªã th√¥ng b√°o
        function displayNotifications() {
            const notificationList = document.getElementById("notificationList");
            notificationList.innerHTML = "";
            notifications.forEach((notif, index) => {
                const iconClass = index === 0 ? "bi-exclamation-circle text-warning" : "bi-info-circle text-primary";
                notificationList.innerHTML += `
                    <li class="dashboard-list-group-item">
                        <div class="d-flex align-items-center">
                            <i class="${iconClass} me-2"></i>
                            <a href="/font-end/student/notification_detail.html?id=${notif.id}" class="dashboard-notification-title text-decoration-none text-dark" data-full-text="${notif.fullText || ''}">
                                ${notif.title || 'Kh√¥ng c√≥ ti√™u ƒë·ªÅ'}
                            </a>
                            <span class="ms-auto text-muted fs-6">${formatDate(notif.date)}</span>
                        </div>
                    </li>
                `;
            });
            if (notifications.length >= 5) document.getElementById("viewMoreNotifications").style.display = "block";
        }

        // Hi·ªÉn th·ªã s·ª± ki·ªán l·ªãch
        function displayCalendarEvents() {
            const calendarList = document.getElementById("calendarList");
            calendarList.innerHTML = "";
            calendarEvents.forEach(event => {
                const iconClass = event.type === "Deadline" ? "bi-folder-check" : 
                                 event.type === "Meeting" ? "bi-people" : 
                                 event.type === "Reminder" ? "bi-bell" : "bi-calendar-event";
                calendarList.innerHTML += `
                    <li class="dashboard-list-group-item">
                        <i class="${iconClass}"></i>
                        <span class="dashboard-notification-title">${event.eventTitle || 'Kh√¥ng c√≥ ti√™u ƒë·ªÅ'}</span>
                        <span class="text-muted">${formatDate(event.startTime)}</span>
                    </li>
                `;
            });
        }

        // Hi·ªÉn th·ªã b·∫£ng c√¥ng vi·ªác
        function displayTable(totalCount) {
            const tableBody = document.getElementById("taskTable");
            tableBody.innerHTML = "";
            tasks.forEach((task, index) => {
                const daysRemaining = calculateDaysRemaining(task.deadline);
                const statusClass = daysRemaining === "H·∫øt h·∫°n n·ªôp" ? "badge bg-danger" : task.status === "Ch∆∞a n·ªôp" ? "badge bg-warning" : "badge bg-success";
                tableBody.innerHTML += `
                    <tr>
                        <td>${(currentPage - 1) * itemsPerPage + index + 1}</td>
                        <td>${task.name || 'Kh√¥ng c√≥ t√™n'}</td>
                        <td>${task.projectName || 'Kh√¥ng c√≥ d·ª± √°n'}</td>
                        <td>${formatDate(task.deadline)}</td>
                        <td>${daysRemaining}</td>
                        <td><span class="${statusClass}">${daysRemaining === "H·∫øt h·∫°n n·ªôp" ? "H·∫øt h·∫°n" : task.status}</span></td>
                        <td>
                            <button class="btn btn-sm btn-info">üëÅÔ∏è Xem</button>
                            ${task.status === "Ch∆∞a n·ªôp" && daysRemaining !== "H·∫øt h·∫°n n·ªôp" ? `<button class="btn btn-sm btn-primary ms-1" onclick="submitTask(${task.id})">üì§ N·ªôp</button>` : ""}
                        </td>
                    </tr>
                `;
            });
            setupPagination(totalCount);
        }

        // T√≠nh th·ªùi gian c√≤n l·∫°i
        function calculateDaysRemaining(deadline) {
            const today = new Date();
            const deadlineDate = new Date(deadline);
            const timeDiff = deadlineDate - today;
            const daysRemaining = Math.ceil(timeDiff / (1000 * 60 * 60 * 24));
            return daysRemaining < 0 ? "H·∫øt h·∫°n n·ªôp" : `${daysRemaining} ng√†y`;
        }

        // Ph√¢n trang
        function setupPagination(totalItems) {
            const totalPages = Math.ceil(totalItems / itemsPerPage);
            const pagination = document.getElementById("pagination");
            pagination.innerHTML = "";
            if (totalPages <= 1) return;

            let paginationHTML = `<li class="page-item"><a class="page-link" href="#" onclick="changePage(1)">¬´</a></li>`;
            if (currentPage > 2) paginationHTML += `<li class="page-item"><a class="page-link" href="#" onclick="changePage(1)">1</a></li>`;
            if (currentPage > 3) paginationHTML += `<li class="page-item disabled"><span class="page-link">...</span></li>`;
            if (currentPage > 1) paginationHTML += `<li class="page-item"><a class="page-link" href="#" onclick="changePage(${currentPage - 1})">${currentPage - 1}</a></li>`;
            paginationHTML += `<li class="page-item active"><a class="page-link" href="#">${currentPage}</a></li>`;
            if (currentPage < totalPages) paginationHTML += `<li class="page-item"><a class="page-link" href="#" onclick="changePage(${currentPage + 1})">${currentPage + 1}</a></li>`;
            if (currentPage < totalPages - 2) paginationHTML += `<li class="page-item disabled"><span class="page-link">...</span></li>`;
            if (currentPage < totalPages - 1) paginationHTML += `<li class="page-item"><a class="page-link" href="#" onclick="changePage(${totalPages})">${totalPages}</a></li>`;
            paginationHTML += `<li class="page-item"><a class="page-link" href="#" onclick="changePage(${totalPages})">¬ª</a></li>`;
            pagination.innerHTML = paginationHTML;
        }

        function changePage(page) {
            currentPage = page;
            loadTasks();
        }

        function filterTable() {
            currentPage = 1;
            loadTasks();
        }

        // N·ªôp c√¥ng vi·ªác
        function submitTask(id) {
            window.location.href = `/font-end/student/student_submissions_list.html?taskId=${id}`;
        }

        // ƒê·ªãnh d·∫°ng ng√†y
        function formatDate(date) {
            if (!date) return "";
            const d = new Date(date);
            return `${d.getDate().toString().padStart(2, "0")}-${(d.getMonth() + 1).toString().padStart(2, "0")}-${d.getFullYear()}`;
        }

        // ƒêƒÉng xu·∫•t
        async function logout() {
            try {
                const response = await fetch(`${API_URL}/api/Auth/logout`, {
                    method: "POST",
                    headers: {
                        "Accept": "*/*",
                        "Content-Type": "application/json",
                        "Authorization": `Bearer ${token}`
                    },
                    credentials: "include"
                });
                const text = await response.text();
                if (response.ok) {
                    const data = text ? JSON.parse(text) : {};
                    alert(data.message || "ƒê√£ ƒëƒÉng xu·∫•t th√†nh c√¥ng.");
                }
            } catch (error) {
                console.error("L·ªói khi ƒëƒÉng xu·∫•t:", error);
            }
            localStorage.removeItem("user");
            localStorage.removeItem("token");
            window.location.replace("/font-end/login/login.html");
        }

        // Kh·ªüi ch·∫°y
        document.addEventListener("DOMContentLoaded", async () => {
            try {
                await loadUserProfile();
                await loadDashboardData();
                await loadNotifications();
                await loadTasks();
                await loadCalendarEvents();
            } catch (error) {
                console.error("L·ªói khi t·∫£i dashboard:", error);
                alert(`Kh√¥ng t·∫£i ƒë∆∞·ª£c d·ªØ li·ªáu: ${error.message || "Vui l√≤ng ƒëƒÉng nh·∫≠p l·∫°i."}`);
                logout();
            }
        });
    </script>
</body>
</html>